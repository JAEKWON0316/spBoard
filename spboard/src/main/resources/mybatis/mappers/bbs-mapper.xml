<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.musecom.spboard.dao.SpBoardMapper">

<sql id="bbsColumn"> <!-- 우리가 쓰려고 만든 id -->
    refid,
    depth,
    renum,
    title,
    content,
    writer,
    pass,
    userid,
    hit,
    chit,
    wdate,
    imnum
</sql>

  <insert id="insert" parameterType="spBoardDto" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO jboard(<include refid="bbsColumn" />) values (
    <!-- 조건 구별 -->
    <choose> <!-- 여기서 if문에서 else는 없다. -->
    	<!-- 답글일 경우 -->
       <when test="refid != 0">
            #{refid},   <!-- 변수는 다 #{}로 해준다. -->
		    #{depth},
		    #{renum},
       </when>
       <!-- 새글일 경우 -->
       <otherwise>  <!-- if문에서 else와 같다. -->
       		last_insertId(),
       		0,
       		0,
       </otherwise>
    </choose>
      #{refid},   <!-- 변수는 다 #{}로 해준다. -->
      #{depth},
      #{renum},
      #{title},
      #{content},
      #{writer},
      #{pass},
      #{userid},
      0,
      0,
      now(),
      unix_timestamp()
    )
   
  </insert>
  
  <update id="update" parameterType="spBoardDto">
    UPDATE jboard
    SET
	    title = #{title},
	    content = #{content},
	    writer = #{writer},
	    pass = #{pass}
    WHERE
    	id = #{id}
  </update>
  
  <delete id="delete" parameterType="int">
    DELETE FROM jboard
    WHERE
      id = #{id}
  </delete>
  
  <select id="selectTotalCount" resultType="int">
  	SELECT
  		COUNT(*)
  	FROM
  		jboard
  </select>
  
  <select id="selectList" resultType="spBoardDto"> <!-- 목록보기에서 list로 해줬지만 어차피 여기서 각각돌면서 list에 담기 때문에 반환타입을 SpBoardDto로 해줘도된다. -->
  	SELECT *
  	FROM
  		jboard
  	ORDER BY refid DESC,
  	renum ASC,
  	LIMIT #{limitPage}, #{viewlist}
  </select>
  
  <select id="selectDetail" resultType="spBoardDto" parameterType="int">
  	SELECT
  		*
  	FROM
  		jboard
  	WHERE
  		id = #{id}
  </select>
</mapper>